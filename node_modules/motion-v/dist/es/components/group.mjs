function notify(node) {
  return !node.isLayoutDirty && node.willUpdate(false);
}
function nodeGroup() {
  const nodes = /* @__PURE__ */ new Set();
  const subscriptions = /* @__PURE__ */ new WeakMap();
  const dirtyAll = (node) => {
    var _a;
    nodes.forEach(notify);
    if (!(node == null ? void 0 : node.options.layoutId))
      (_a = node == null ? void 0 : node.root) == null ? void 0 : _a.didUpdate();
  };
  return {
    add: (node) => {
      nodes.add(node);
      subscriptions.set(
        node,
        node.addEventListener("willUpdate", () => dirtyAll(node))
      );
    },
    remove: (node) => {
      nodes.delete(node);
      const unsubscribe = subscriptions.get(node);
      if (unsubscribe) {
        unsubscribe();
        subscriptions.delete(node);
      }
      dirtyAll(node);
    },
    dirty: dirtyAll
  };
}
export {
  nodeGroup
};
